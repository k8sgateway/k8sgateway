name: CI
on: pull_request
jobs:
  codegen:
    name: codegen check
    runs-on: ubuntu-22.04
    steps:
      - name: Check out code into the Go module directory
        uses: actions/checkout@v3
      - name: Prep Go Runner
        uses: ./.github/workflows/composite-actions/prep-go-runner-old
      - name: Install Protoc
        uses: arduino/setup-protoc@v1
        with:
          version: '3.6.1'
          repo-token: ${{ secrets.GITHUB_TOKEN }}
      - name: Generate Code
        run: |
          ./ci/check-generated-code.sh
      - name: Go Cache Paths
        id: go-cache-paths
        shell: bash
        run: |
          echo "go-build=$(go env GOCACHE)" >> $GITHUB_OUTPUT
          echo "go-mod=$(go env GOMODCACHE)" >> $GITHUB_OUTPUT
      - name: Print Cache
        shell: bash
        run: |
          du -h --max-depth=1 ${{ steps.go-cache-paths.outputs.go-build }}
          du -h --max-depth=1 ${{ steps.go-cache-paths.outputs.go-mod }} || true