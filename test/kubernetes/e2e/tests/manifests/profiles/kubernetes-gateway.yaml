# This file defines the profile for a user who wants to run Gloo Gateway with:
# - Kubernetes Gateway API enabled
# - Edge Gateway API disabled

# Configuration that is Global to Gloo Gateway
global:
  image:
    pullPolicy: IfNotPresent
  # Note: glooRbac.namespaced settings are not supported with Gloo Gateway https://github.com/solo-io/solo-projects/issues/6064
  # Gateway API fundamentally expects HTTPRoutes and Gateways in any namespace and cross-namespace references to be supported
  # Currently we are explicitly disabled namespaced roles for Gloo Gateway tests, but this can be left unset.
  glooRbac:
    namespaced: false

# Configuration for the Settings CR
settings:
  # Gloo Gateway requires access to namespaces outside of the install namespace to watch and create Gateway resources
  # singleNamespace=false must be set for namespace watch to work correctly. See: https://github.com/solo-io/solo-projects/issues/6058
  singleNamespace: false
  create: true
  invalidConfigPolicy:
    replaceInvalidRoutes: true
    invalidRouteResponseCode: 404
    invalidRouteResponseBody: Gloo Gateway has invalid configuration.

# Configuration for the Edge Gateway integration in Gloo Gateway
gateway:
  persistProxySpec: false
  isolateVirtualHostsBySslConfig: true
  readGatewaysFromAllNamespaces: true
  validation:
    allowWarnings: true
    alwaysAcceptResources: false
    warnMissingTlsSecret: true
    serverEnabled: true
    disableTransformationValidation: false
    warnRouteShortCircuiting: true
    webhook:
      # skipping delete validation due to flakes per https://github.com/solo-io/solo-projects/issues/6272
      skipDeleteValidationResources:
        - upstreams

# Configuration for the Kubernetes Gateway integration in Gloo Gateway
kubeGateway:
  enabled: true

# Configuration for the Gloo pod
gloo:
  logLevel: info
  disableLeaderElection: false
  deployment:
    replicas: 1
    livenessProbeEnabled: true
    # Resource requests and limits should be identified by users directly
    # We define them here to ensure that tests can pass with resources defined
    resources:
      requests:
        cpu: 500m
        memory: 5Gi
      limits:
        cpu: 1000m
        memory: 10Gi

# Configuration for the statically deployed gateway-proxy that ships by default with Gloo Gateway
gatewayProxies:
  gatewayProxy:
    # Disable the default gateway-proxy, so that the only proxies are ones provisioned
    # by the Kubernetes Gateway API
    disabled: true

# Configuration for the Discovery pod
discovery:
  # Discovery is not recommended for production, so we disable it
  # NOTE TO TEST AUTHORS: Upstreams must be statically defined in the manifests
  enabled: false