{{- if .Values.kubeGateway.enabled -}}
kind: GatewayParameters
apiVersion: gateway.gloo.solo.io/v1alpha1
metadata:
  labels:
    {{- include "gloo-gateway.constLabels" . | nindent 4 }}
  name: gloo-gateway
  namespace: {{ .Release.Namespace }}
spec:
  kube:
{{- if .Values.kubeGateway.gatewayParameters }}
{{- if .Values.kubeGateway.gatewayParameters.glooGateway }}
{{- $gg := .Values.kubeGateway.gatewayParameters.glooGateway -}}
{{- $global := .Values.global }}
    deployment:
      replicas: {{ $gg.proxyDeployment.replicas }}
{{- if $gg.service }}
    service:
      type: {{ $gg.service.type }}
{{- end }}{{/* if $gg.service */}}
    envoyContainer:
      image:
        {{- merge $gg.envoyContainer.image $global.image | include "gloo-gateway.gatewayParametersImage" | nindent 8 }}
    podTemplate:
      extraLabels:
        {{- include "gloo-gateway.constLabels" . | nindent 8 }}
{{- if $gg.sdsContainer }}
    sdsContainer:
      image:
        {{- merge $gg.sdsContainer.image $global.image | include "gloo-gateway.gatewayParametersImage" | nindent 8 }}
{{- if $gg.sdsContainer.securityContext }}
      securityContext:
        {{- toYaml $gg.sdsContainer.securityContext | nindent 8 }}
{{- end }}{{/* if $gg.sdsContainer.securityContext */}}
{{- if $gg.sdsContainer.logLevel }}
      bootstrap:
        logLevel: {{ $gg.sdsContainer.logLevel }}
{{- end }}{{/* if $gg.sdsContainer.logLevel */}}
{{- if $gg.sdsContainer.sdsResources }}
      resources:
        {{- toYaml $gg.sdsContainer.sdsResources | nindent 8 }}
{{- end }}{{/* if $gg.sdsContainer.sdsResources */}}
    istio:
{{- if $gg.istio.customSidecars }}
      customSidecars:
        {{- toYaml $gg.istio.customSidecars | nindent 6 }}
{{- end }}{{/* if $gg.istio.customSidecars */}}
{{- if and $gg.istio.istioProxyContainer (not $gg.istio.customSidecars) }}
      istioProxyContainer:
        image:
          {{- merge $gg.istio.istioProxyContainer.image $global.image | include "gloo-gateway.gatewayParametersImage" | nindent 10 }}
{{- if $gg.istio.istioProxyContainer.securityContext }}
        securityContext:
          {{- toYaml $gg.istio.istioProxyContainer.securityContext | nindent 10 }}
{{- end }}{{/* if $gg.istio.istioProxyContainer.securityContext */}}
{{- if $gg.istio.istioProxyContainer.logLevel }}
        logLevel: {{ $gg.istio.istioProxyContainer.logLevel }}
{{- end }}{{/* if $gg.istio.istioProxyContainer.logLevel */}}
        istioDiscoveryAddress: {{ $gg.istio.istioProxyContainer.istioDiscoveryAddress }}
        istioMetaMeshId: {{ $gg.istio.istioProxyContainer.istioMetaMeshId }}
        istioMetaClusterId: {{ $gg.istio.istioProxyContainer.istioMetaClusterId }}
{{- end }}{{/* if and $gg.istio.istioProxyContainer (not $gg.istio.customSidecars) */}}
{{- end }}{{/* if $gg.sdsContainer */}}
{{- end }}{{/* if .Values.kubeGateway.gatewayParameters.glooGateway */}}
{{- end }}{{/* if .Values.kubeGateway.gatewayParameters */}}
{{- end }}{{/* if .Values.kubeGateway.enabled */}}